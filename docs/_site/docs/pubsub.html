<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="FFWD Documentation">
    <meta name="author" content="Spotify">
    <base href="/ffwd/">

    <title>FFWD Documentation</title>

    <!-- prism -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-css.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-json.min.js"></script>
    <script src="assets/js/prism-hql.js" type="text/javascript"></script>
    <script src="assets/js/prism-ts.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism-tomorrow.min.css" />

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-social/5.0.0/bootstrap-social.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css" />

    <link rel="stylesheet" href="assets/css/index.css" />
    <link rel="stylesheet" href="assets/css/docs.css" />
  </head>
  <body>
    <nav class="navbar navbar-inverse">
      <div class="container">
        <div class="navbar-left">
          <a href="/ffwd/">
            <img src="images/smalllogo.jpg" style="margin-top: .25em;" />
          </a>
        </div>

        <ul class="nav navbar-nav">
          <li class="active">
            <a href="docs/overview">Documentation</a>
          </li>
        </ul>

        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="https://github.com/spotify/ffwd">
              <span class="fa fa-github"></span>
              FFWD on Github
            </a>
          </li>
          <li>
            <a href="https://github.com/spotify/ffwd/tree/master/docs">
              <span class="fa fa-pencil"></span>
              Improve this site
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <div class="row">
  <div class="col-md-3">
    <ul class="nav">
      <li >
        <a href="docs/overview">Overview</a>
      </li>

      <li >
        <a href="docs/components">Components</a>
      </li>

      <li >
        <a href="docs/modules">Modules</a>

	<ul class="nav">
          <li >
            <a href="docs/http">HTTP</a>
          </li>

	  <li >
            <a href="docs/json">JSON</a>
          </li>

          <li >
            <a href="docs/protobuf">Protobuf</a>
          </li>
        </ul>
      </li>

      <li >
        <a href="docs/on-disk-queue">On-disk Persistent Queue</a>
      </li>

    </ul>
  </div>

  <div class="col-md-9">
    <h1 id="fastforward-pubsub">FastForward Pubsub</h1>

<p>This modules provides a <a href="https://cloud.google.com/pubsub/docs/overview">Google Pubsub</a> output plugin.</p>

<h2 id="configuration">Configuration</h2>

<ul>
  <li><code class="highlighter-rouge">project</code> - the google project where the topic exists.</li>
  <li><code class="highlighter-rouge">topic</code> - the google pubsub topic to publish to.</li>
</ul>

<p>The default settings the publisher uses for batching requests can be overriden. The API allows publishing
based on request size, message count and time since last publish. The client by default automatically retries failed requests.</p>

<ul>
  <li><code class="highlighter-rouge">requestBytesThreshold</code> - number of bytes to wait for.</li>
  <li><code class="highlighter-rouge">messageCountBatchSize</code> - number of messages to wait for.</li>
  <li><code class="highlighter-rouge">publishDelayThresholdMs</code> - amount of type to wait for.</li>
</ul>

<p>Here is an example config of setting up the pubsub plugin.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>output:
  plugins:
    - type: pubsub
      flushInterval: 10000
      project: google-test-project
      topic: test-topic
</code></pre></div></div>

<h2 id="authentication">Authentication</h2>

<p>If running ffwd from within GCE the default application credentials can be used for authentication.</p>

<p>If you have multiple google projects and would rather distribute a service account to each instance, ensure the environment variable <code class="highlighter-rouge">GOOGLE_APPLICATION_CREDENTIALS</code> is set to the path of the JSON file.</p>

<p>To learn how to setup these credentials or generate a service account read https://cloud.google.com/docs/authentication/production.</p>

<h2 id="pubsub-emulator">Pubsub Emulator</h2>

<p>Instead of using real Google pubsub resources, the pubsub emulator can be used for local development.</p>

<p>Follow https://cloud.google.com/pubsub/docs/emulator to setup and start the emulator.</p>

<p>Start ffwd after exporting an environment variable like below to point at the emulator.
<code class="highlighter-rouge">export PUBSUB_EMULATOR_HOST=localhost:8085</code></p>

<p>Note - no topics or subscriptions are created by default. You can use the python pubsub library like soâ€¦</p>

<p>TODO - Move this to a utility class in Java.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">pubsub_v1</span>

<span class="n">project</span> <span class="o">=</span> <span class="s">'google-test-project'</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pubsub_v1</span><span class="o">.</span><span class="n">PublisherClient</span><span class="p">()</span>
<span class="n">tp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">topic_path</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="s">'test-topic'</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">create_topic</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">pubsub_v1</span><span class="o">.</span><span class="n">SubscriberClient</span><span class="p">()</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">subscription_path</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="s">'test-subscription'</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>

<span class="n">c</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

</code></pre></div></div>

  </div>
</div>

    </div>
  </body>
</html>
